import { GameMap } from "./types";

// Wall types: 0 = empty, 1-4 = outdoor walls, 5 = mansion exterior, 6 = mansion interior, 7 = stairs

// Base map — outdoor area + mansion exterior shell
// The mansion interior (cols 24-37, rows 12-38) gets overlaid per floor
export const BASE_MAP: GameMap = {
  width: 40,
  height: 40,
  spawnX: 3.5,
  spawnY: 3.5,
  spawnAngle: 0,
  walls: [
    // Row 0-9: Outdoor area (top)
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,2,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,2,0,2,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    // Row 10-19
    [1,0,0,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,4,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,2,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    // Row 20-29
    [1,0,0,0,2,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    // Row 30-39
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  ],
};

// Mansion region boundaries
const MANSION_COL_START = 24;
const MANSION_ROW_START = 12;

// Mansion zone bounds (for music switching)
export const MANSION_BOUNDS = {
  minX: 24,
  maxX: 38,
  minY: 12,
  maxY: 38,
};

// Each floor layout is a 27x14 grid overlaid onto the base map at (cols 24-37, rows 12-38)
// Floor 1: Ground floor with entrance from outside, rooms, stairs up
const MANSION_FLOOR_1: number[][] = [
  //col:24 25 26 27 28 29 30 31 32 33 34 35 36 37
  [5,5,5,5,5,5,5,5,5,5,5,5,5,5],  // row 12 - top wall
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 13
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 14
  [5,0,0,6,6,6,0,0,6,6,6,0,0,5],  // row 15 - side rooms
  [5,0,0,6,0,6,0,0,6,0,6,0,0,5],  // row 16
  [5,0,0,6,0,6,0,0,6,0,6,0,0,5],  // row 17
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 18
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 19
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 20
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 21
  [0,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 22 - entrance (west wall open)
  [0,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 23 - entrance
  [5,0,0,0,0,0,7,7,0,0,0,0,0,5],  // row 24 - STAIRS UP (cols 30-31)
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 25
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 26
  [5,0,0,6,6,6,6,6,6,6,6,0,0,5],  // row 27 - dividing wall
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 28
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 29
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 30
  [5,0,0,6,6,6,0,0,6,6,6,0,0,5],  // row 31 - more rooms
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 32
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 33
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 34
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 35
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 36
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 37
  [5,5,5,5,5,5,5,5,5,5,5,5,5,5],  // row 38 - bottom wall
];

// Floor 2: Guard quarters, different layout, stairs up and down
const MANSION_FLOOR_2: number[][] = [
  [5,5,5,5,5,5,5,5,5,5,5,5,5,5],  // row 12
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 13
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 14
  [5,0,0,6,6,0,0,0,0,6,6,0,0,5],  // row 15
  [5,0,0,6,0,0,0,0,0,0,7,7,0,5],  // row 16 - STAIRS UP (cols 34-35)
  [5,0,0,0,0,0,6,6,0,0,0,0,0,5],  // row 17
  [5,0,0,0,0,0,6,0,0,0,0,0,0,5],  // row 18
  [5,0,0,6,0,0,0,0,0,6,0,0,0,5],  // row 19
  [5,0,0,6,0,0,0,0,0,6,0,0,0,5],  // row 20
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 21
  [5,0,0,0,0,6,6,6,6,0,0,0,0,5],  // row 22 - west wall CLOSED
  [5,0,0,0,0,6,0,0,6,0,0,0,0,5],  // row 23
  [5,0,0,0,0,0,7,7,0,0,0,0,0,5],  // row 24 - STAIRS DOWN (cols 30-31)
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 25
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 26
  [5,0,0,6,6,6,0,0,6,6,6,0,0,5],  // row 27
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 28
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 29
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 30
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 31
  [5,0,0,0,0,0,6,6,0,0,0,0,0,5],  // row 32
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 33
  [5,0,0,6,6,0,0,0,0,6,6,0,0,5],  // row 34
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 35
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 36
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 37
  [5,5,5,5,5,5,5,5,5,5,5,5,5,5],  // row 38
];

// Floor 3: Bowser's lair - big throne room with princess
const MANSION_FLOOR_3: number[][] = [
  [5,5,5,5,5,5,5,5,5,5,5,5,5,5],  // row 12
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 13
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 14
  [5,0,0,6,0,0,0,0,0,0,6,0,0,5],  // row 15
  [5,0,0,6,0,0,0,0,0,0,7,7,0,5],  // row 16 - STAIRS DOWN (cols 34-35)
  [5,0,0,6,0,0,0,0,0,0,0,0,0,5],  // row 17
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 18
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 19
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 20 - open throne approach
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 21
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 22 - west wall CLOSED
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 23
  [5,0,0,6,6,0,0,0,0,6,6,0,0,5],  // row 24
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 25
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 26
  [5,0,0,6,6,6,6,0,6,6,6,6,0,5],  // row 27 - throne room wall (gap at col 31)
  [5,0,0,6,0,0,0,0,0,0,0,6,0,5],  // row 28 - throne room
  [5,0,0,6,0,0,0,0,0,0,0,6,0,5],  // row 29
  [5,0,0,6,0,0,0,0,0,0,0,6,0,5],  // row 30 - BOWSER HERE
  [5,0,0,6,0,0,0,0,0,0,0,6,0,5],  // row 31
  [5,0,0,6,0,0,0,0,0,0,0,6,0,5],  // row 32
  [5,0,0,6,0,0,0,0,0,0,0,6,0,5],  // row 33
  [5,0,0,6,6,6,0,0,6,6,6,6,0,5],  // row 34 - back wall (gap at cols 30-31)
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 35 - PRINCESS HERE
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 36
  [5,0,0,0,0,0,0,0,0,0,0,0,0,5],  // row 37
  [5,5,5,5,5,5,5,5,5,5,5,5,5,5],  // row 38
];

const MANSION_FLOORS = [MANSION_FLOOR_1, MANSION_FLOOR_2, MANSION_FLOOR_3];

// Build a complete map for a given floor by overlaying mansion layout onto base map
export function buildFloorMap(floor: number): GameMap {
  const walls = BASE_MAP.walls.map(row => [...row]);

  const layout = MANSION_FLOORS[floor - 1];
  for (let r = 0; r < layout.length; r++) {
    const mapRow = MANSION_ROW_START + r;
    for (let c = 0; c < layout[r].length; c++) {
      const mapCol = MANSION_COL_START + c;
      walls[mapRow][mapCol] = layout[r][c];
    }
  }

  return {
    walls,
    width: BASE_MAP.width,
    height: BASE_MAP.height,
    spawnX: BASE_MAP.spawnX,
    spawnY: BASE_MAP.spawnY,
    spawnAngle: BASE_MAP.spawnAngle,
  };
}

// Stairs — same x,y position, just changes floor. Player stays in place.
export const STAIRS = [
  // Floor 1 <-> Floor 2 via staircase at cols 30-31, row 24
  { x: 30, y: 24, fromFloor: 1, toFloor: 2 },
  { x: 31, y: 24, fromFloor: 1, toFloor: 2 },
  { x: 30, y: 24, fromFloor: 2, toFloor: 1 },
  { x: 31, y: 24, fromFloor: 2, toFloor: 1 },
  // Floor 2 <-> Floor 3 via staircase at cols 34-35, row 16
  { x: 34, y: 16, fromFloor: 2, toFloor: 3 },
  { x: 35, y: 16, fromFloor: 2, toFloor: 3 },
  { x: 34, y: 16, fromFloor: 3, toFloor: 2 },
  { x: 35, y: 16, fromFloor: 3, toFloor: 2 },
];

// Ammo drop spawn locations with floor assignments
export const AMMO_SPAWNS = [
  // Outdoor area (floor 1)
  { x: 6.5, y: 2.5, floor: 1 },
  { x: 15.5, y: 7.5, floor: 1 },
  { x: 3.5, y: 12.5, floor: 1 },
  { x: 8.5, y: 18.5, floor: 1 },
  { x: 20.5, y: 10.5, floor: 1 },
  { x: 12.5, y: 35.5, floor: 1 },
  // Mansion floor 1
  { x: 26.5, y: 14.5, floor: 1 },
  { x: 30.5, y: 22.5, floor: 1 },
  // Mansion floor 2
  { x: 32.5, y: 20.5, floor: 2 },
  { x: 26.5, y: 35.5, floor: 2 },
  // Mansion floor 3
  { x: 30.5, y: 15.5, floor: 3 },
];

// Princess location (floor 3 — Bowser's lair, behind the throne room)
export const PRINCESS_LOCATION = { x: 31.5, y: 35.5, floor: 3 };

export function isWall(map: GameMap, x: number, y: number): boolean {
  const mx = Math.floor(x);
  const my = Math.floor(y);
  if (mx < 0 || mx >= map.width || my < 0 || my >= map.height) return true;
  const tile = map.walls[my][mx];
  // 7 = stairs, walkable
  return tile !== 0 && tile !== 7;
}

export function isInMansion(x: number, y: number, floor: number): boolean {
  if (floor > 1) return true;
  return (
    x >= MANSION_BOUNDS.minX &&
    x <= MANSION_BOUNDS.maxX &&
    y >= MANSION_BOUNDS.minY &&
    y <= MANSION_BOUNDS.maxY
  );
}
